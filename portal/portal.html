<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Portal - Content Bug</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            /* Dark Theme Foundation */
            --dark-bg: #050508;
            --dark-card: #0a0a0f;
            --dark-surface: #0f0f14;
            --dark-input: #08080c;
            --dark-border: #1a1a2e;

            /* Text */
            --text-white: #ffffff;
            --text-light: #94a3b8;
            --text-muted: #64748b;

            /* Status Colors */
            --green: #22c55e;
            --green-dark: #059669;
            --orange: #f59e0b;
            --red: #ef4444;

            /* Subscription Tier Colors - Lush Gradients */
            /* Trial - Warm Amber */
            --tier-trial: #f59e0b;
            --tier-trial-dark: #78350f;
            --tier-trial-glow: rgba(245, 158, 11, 0.15);

            /* Basic - Deep Blue */
            --tier-basic: #3b82f6;
            --tier-basic-dark: #1e3a8a;
            --tier-basic-light: #60a5fa;
            --tier-basic-glow: rgba(59, 130, 246, 0.15);

            /* Silver - Refined Gray */
            --tier-silver: #94a3b8;
            --tier-silver-dark: #475569;
            --tier-silver-light: #cbd5e1;
            --tier-silver-glow: rgba(148, 163, 184, 0.12);

            /* Gold - Rich Warm */
            --tier-gold: #d4a017;
            --tier-gold-dark: #92710a;
            --tier-gold-light: #fbbf24;
            --tier-gold-glow: rgba(212, 160, 23, 0.15);

            /* Pro - Royal Purple */
            --tier-pro: #7c3aed;
            --tier-pro-dark: #4c1d95;
            --tier-pro-light: #a855f7;
            --tier-pro-glow: rgba(124, 58, 237, 0.15);

            /* Dynamic theme color (set by JS based on subscription) */
            --theme-primary: var(--tier-basic);
            --theme-dark: var(--tier-basic-dark);
            --theme-light: var(--tier-basic-light);
            --theme-glow: var(--tier-basic-glow);
        }

        /* Subscription theme classes */
        body.tier-trial {
            --theme-primary: var(--tier-trial);
            --theme-dark: var(--tier-trial-dark);
            --theme-light: var(--tier-trial);
            --theme-glow: var(--tier-trial-glow);
        }

        body.tier-basic {
            --theme-primary: var(--tier-basic);
            --theme-dark: var(--tier-basic-dark);
            --theme-light: var(--tier-basic-light);
            --theme-glow: var(--tier-basic-glow);
        }

        body.tier-silver {
            --theme-primary: var(--tier-silver);
            --theme-dark: var(--tier-silver-dark);
            --theme-light: var(--tier-silver-light);
            --theme-glow: var(--tier-silver-glow);
        }

        body.tier-gold {
            --theme-primary: var(--tier-gold);
            --theme-dark: var(--tier-gold-dark);
            --theme-light: var(--tier-gold-light);
            --theme-glow: var(--tier-gold-glow);
        }

        body.tier-pro {
            --theme-primary: var(--tier-pro);
            --theme-dark: var(--tier-pro-dark);
            --theme-light: var(--tier-pro-light);
            --theme-glow: var(--tier-pro-glow);
        }

        /* Animations */
        @keyframes subtleGlow {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }

        @keyframes badgeDrift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        html, body {
            height: 100%;
            background: var(--dark-bg);
            font-family: 'Inter', -apple-system, sans-serif;
            color: var(--text-white);
        }

        .app {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* === SIDEBAR === */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #0a0a0f 0%, #08080c 50%, #060609 100%);
            border-right: 1px solid var(--dark-border);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Ambient glow based on subscription tier */
        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at 50% 0%, var(--theme-glow) 0%, transparent 60%);
            pointer-events: none;
            animation: subtleGlow 6s ease-in-out infinite;
        }

        /* Sidebar Header with Banner */
        .sidebar-header {
            border-bottom: 1px solid var(--dark-border);
            position: relative;
        }

        .sidebar-banner {
            position: relative;
            height: 180px;
            background: linear-gradient(135deg, #050508 0%, #0a0a12 50%, #050508 100%);
            overflow: hidden;
        }

        /* Animated smoke layers behind logo */
        .sidebar-banner::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 300px;
            background: radial-gradient(ellipse 60% 50% at center,
                rgba(30, 58, 138, 0.15) 0%,
                rgba(37, 99, 235, 0.08) 40%,
                transparent 70%);
            filter: blur(40px);
            animation: smokeDrift1 20s ease-in-out infinite;
        }

        .sidebar-banner::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 350px;
            height: 250px;
            background: radial-gradient(ellipse 50% 60% at center,
                rgba(59, 130, 246, 0.12) 0%,
                rgba(96, 165, 250, 0.06) 45%,
                transparent 75%);
            filter: blur(50px);
            animation: smokeDrift2 25s ease-in-out infinite reverse;
        }

        @keyframes smokeDrift1 {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.6;
            }
            33% {
                transform: translate(-45%, -55%) scale(1.1);
                opacity: 0.8;
            }
            66% {
                transform: translate(-55%, -45%) scale(0.95);
                opacity: 0.5;
            }
        }

        @keyframes smokeDrift2 {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0.5;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.15) rotate(5deg);
                opacity: 0.7;
            }
        }

        .sidebar-banner-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, rgba(10, 10, 15, 0.6) 0%, rgba(5, 5, 8, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 50%;
            backdrop-filter: blur(16px);
            box-shadow:
                0 8px 40px rgba(0, 0, 0, 0.6),
                0 0 80px var(--theme-glow),
                inset 0 0 30px rgba(59, 130, 246, 0.03);
            animation: logoBreathe 5s ease-in-out infinite;
            z-index: 2;
        }

        @keyframes logoBreathe {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow:
                    0 8px 40px rgba(0, 0, 0, 0.6),
                    0 0 80px var(--theme-glow),
                    inset 0 0 30px rgba(59, 130, 246, 0.03);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.03);
                box-shadow:
                    0 12px 50px rgba(0, 0, 0, 0.7),
                    0 0 100px var(--theme-glow),
                    inset 0 0 40px rgba(59, 130, 246, 0.05);
            }
        }

        .sidebar-banner-logo img {
            width: 80px;
            height: 80px;
            filter:
                brightness(1.1)
                drop-shadow(0 4px 16px rgba(0, 0, 0, 0.6))
                drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
        }

        /* Welcome Section */
        .sidebar-welcome {
            padding: 16px 18px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, transparent 100%);
            border-bottom: 1px solid var(--dark-border);
        }

        .welcome-text {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .client-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-white);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subscription-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #ffffff;
        }

        /* Tier-specific badge styling */
        .subscription-badge.trial {
            background: linear-gradient(90deg, #78350f, #92400e, #d97706, #f59e0b, #d97706, #92400e);
            background-size: 300% 100%;
            animation: badgeDrift 12s linear infinite;
            box-shadow: 0 2px 12px rgba(245, 158, 11, 0.25);
        }

        .subscription-badge.basic {
            background: linear-gradient(90deg, #0f172a, #1e3a8a, #3b82f6, #60a5fa, #3b82f6, #1e3a8a);
            background-size: 300% 100%;
            animation: badgeDrift 15s linear infinite;
            box-shadow: 0 2px 12px rgba(59, 130, 246, 0.25);
        }

        .subscription-badge.silver {
            background: linear-gradient(90deg, #334155, #64748b, #94a3b8, #cbd5e1, #94a3b8, #64748b);
            background-size: 300% 100%;
            animation: badgeDrift 14s linear infinite;
            box-shadow: 0 2px 12px rgba(148, 163, 184, 0.2);
        }

        .subscription-badge.gold {
            background: linear-gradient(90deg, #78350f, #92710a, #d4a017, #fbbf24, #d4a017, #92710a);
            background-size: 300% 100%;
            animation: badgeDrift 16s linear infinite;
            border: 1px solid rgba(251, 191, 36, 0.3);
            box-shadow:
                0 2px 12px rgba(212, 160, 23, 0.3),
                0 0 20px rgba(251, 191, 36, 0.1);
        }

        .subscription-badge.pro {
            background: linear-gradient(90deg, #2e1065, #4c1d95, #7c3aed, #a855f7, #7c3aed, #4c1d95);
            background-size: 300% 100%;
            animation: badgeDrift 14s linear infinite;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow:
                0 2px 12px rgba(124, 58, 237, 0.3),
                0 0 20px rgba(168, 85, 247, 0.1);
        }

        .subscription-badge svg {
            width: 12px;
            height: 12px;
        }

        /* Navigation */
        .sidebar-nav {
            flex: 1;
            padding: 16px 12px;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        /* Role-based nav visibility - hidden by default */
        .nav-section.role-admin,
        .nav-section.role-team {
            display: none;
        }

        /* Show admin section for admin/owner */
        body.is-admin .nav-section.role-admin,
        body.is-owner .nav-section.role-admin {
            display: block;
        }

        /* Show team section for admin/owner/editor */
        body.is-admin .nav-section.role-team,
        body.is-owner .nav-section.role-team,
        body.is-editor .nav-section.role-team {
            display: block;
        }

        /* Role accent colors for nav sections */
        body.is-admin .nav-section.role-admin .nav-section-title,
        body.is-owner .nav-section.role-admin .nav-section-title {
            color: #f59e0b;
        }

        body.is-admin .nav-section.role-team .nav-section-title,
        body.is-owner .nav-section.role-team .nav-section-title,
        body.is-editor .nav-section.role-team .nav-section-title {
            color: #3b82f6;
        }

        /* Client Channels List */
        .client-channels-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .client-channels-title .chevron {
            width: 14px;
            height: 14px;
            transition: transform 0.2s ease;
        }

        .client-channels-title.collapsed .chevron {
            transform: rotate(-90deg);
        }

        .client-channels-list {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-height: 300px;
            overflow-y: auto;
            transition: max-height 0.3s ease;
        }

        .client-channels-list.collapsed {
            max-height: 0;
            overflow: hidden;
        }

        .client-channels-list::-webkit-scrollbar {
            width: 4px;
        }

        .client-channels-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .client-channels-list::-webkit-scrollbar-thumb {
            background: var(--dark-border);
            border-radius: 2px;
        }

        .channel-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
            color: var(--text-secondary);
        }

        .channel-item:hover {
            background: rgba(59, 130, 246, 0.08);
            color: var(--text-white);
        }

        .channel-item.active {
            background: rgba(59, 130, 246, 0.15);
            color: var(--text-white);
        }

        .channel-item.has-unread {
            color: var(--text-white);
        }

        .channel-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }

        .channel-info {
            flex: 1;
            min-width: 0;
        }

        .channel-name {
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .channel-status {
            font-size: 10px;
            color: var(--text-muted);
        }

        .channel-badge {
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: #ef4444;
            border-radius: 9px;
            font-size: 10px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .channel-loading {
            padding: 12px 14px;
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
        }

        /* Tier colors for channel avatars */
        .channel-avatar.tier-trial { background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%); }
        .channel-avatar.tier-basic { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .channel-avatar.tier-silver { background: linear-gradient(135deg, #475569 0%, #94a3b8 100%); }
        .channel-avatar.tier-gold { background: linear-gradient(135deg, #92400e 0%, #f59e0b 100%); }
        .channel-avatar.tier-pro { background: linear-gradient(135deg, #6b21a8 0%, #a855f7 100%); }

        .nav-section-title {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            padding: 8px 14px;
            margin-bottom: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            margin: 3px 0;
            border-radius: 10px;
            color: var(--text-light);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border-color: rgba(255, 255, 255, 0.06);
            color: var(--text-white);
            transform: translateX(2px);
        }

        .nav-item.active {
            background: linear-gradient(135deg,
                color-mix(in srgb, var(--theme-dark) 15%, transparent),
                color-mix(in srgb, var(--theme-primary) 8%, transparent)
            );
            border: 1px solid color-mix(in srgb, var(--theme-primary) 20%, transparent);
            color: var(--text-white);
            box-shadow:
                0 0 20px var(--theme-glow),
                inset 0 0 12px color-mix(in srgb, var(--theme-primary) 5%, transparent);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--theme-dark), var(--theme-primary), var(--theme-light));
            border-radius: 0 3px 3px 0;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            opacity: 0.7;
        }

        .nav-item:hover svg,
        .nav-item.active svg {
            opacity: 1;
        }

        .nav-item .badge {
            margin-left: auto;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item.has-notification .badge {
            background: color-mix(in srgb, var(--theme-primary) 20%, transparent);
            border-color: color-mix(in srgb, var(--theme-primary) 30%, transparent);
            color: var(--text-white);
        }

        /* Locked Items */
        .nav-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-item.locked:hover {
            transform: none;
            background: transparent;
            border-color: transparent;
        }

        .nav-item.locked .lock-icon {
            margin-left: auto;
            width: 14px;
            height: 14px;
            color: var(--text-muted);
        }

        .nav-item.locked .lock-tooltip {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 12px;
            padding: 8px 12px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            font-size: 11px;
            color: var(--text-light);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .nav-item.locked:hover .lock-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* User Section */
        .user-section {
            padding: 16px;
            border-top: 1px solid var(--dark-border);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01) 0%, transparent 100%);
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border: 1px solid rgba(255, 255, 255, 0.04);
            border-radius: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--theme-dark), var(--theme-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: white;
            position: relative;
            flex-shrink: 0;
        }

        .user-avatar .status-dot {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--dark-card);
            background: var(--green);
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-white);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-email {
            font-size: 11px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-settings-btn {
            width: 34px;
            height: 34px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .user-settings-btn:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
        }

        .user-settings-btn svg {
            width: 16px;
            height: 16px;
        }

        /* === MAIN CONTENT === */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--dark-bg);
            overflow: hidden;
            position: relative;
        }

        /* Subtle background glow */
        .main::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: radial-gradient(ellipse at 50% 0%, var(--theme-glow) 0%, transparent 70%);
            pointer-events: none;
            opacity: 0.5;
        }

        .main-header {
            padding: 20px 28px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, rgba(12, 12, 16, 0.8) 0%, transparent 100%);
            position: relative;
            z-index: 1;
        }

        .main-header-left h2 {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .main-header-left p {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .main-content {
            flex: 1;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .main-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Status indicator */
        .status-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: rgba(34, 197, 94, 0.08);
            border: 1px solid rgba(34, 197, 94, 0.15);
            border-radius: 20px;
        }

        .status-dot-live {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        }

        .status-text {
            font-size: 12px;
            font-weight: 600;
            color: var(--green);
        }

        /* === CHAT PANEL === */
        .chat-panel {
            width: 340px;
            background: linear-gradient(180deg, #0a0a0f 0%, #08080c 100%);
            border-left: 1px solid var(--dark-border);
            display: flex;
            flex-direction: column;
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chat-panel.open {
            transform: translateX(0);
        }

        /* Floating Chat Button */
        .chat-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--theme-dark), var(--theme-primary));
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 24px var(--theme-glow),
                        0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chat-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 32px var(--theme-glow),
                        0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .chat-fab svg {
            width: 26px;
            height: 26px;
            color: white;
        }

        .chat-fab .unread-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 22px;
            height: 22px;
            background: #ef4444;
            border-radius: 11px;
            font-size: 11px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            border: 2px solid var(--dark-bg);
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease;
        }

        .chat-fab .unread-badge.visible {
            opacity: 1;
            transform: scale(1);
        }

        .chat-fab.hidden {
            transform: translateY(100px);
            opacity: 0;
            pointer-events: none;
        }

        /* Chat panel overlay for mobile */
        .chat-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .chat-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .chat-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: radial-gradient(ellipse at 50% 0%, var(--theme-glow) 0%, transparent 80%);
            pointer-events: none;
            opacity: 0.3;
        }

        .chat-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .chat-header-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-header-title svg {
            width: 20px;
            height: 20px;
            color: var(--theme-primary);
        }

        .chat-header-title h3 {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-white);
        }

        .chat-header-title .online-indicator {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            margin-left: 4px;
        }

        .chat-minimize {
            width: 28px;
            height: 28px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .chat-minimize:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.12);
            color: var(--text-light);
        }

        .chat-minimize svg {
            width: 14px;
            height: 14px;
        }

        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            display: flex;
            gap: 10px;
            animation: fadeSlideUp 0.3s ease;
        }

        .chat-message.own {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--dark-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .message-avatar.team {
            background: linear-gradient(135deg, var(--theme-dark), var(--theme-primary));
        }

        .message-content {
            max-width: 240px;
        }

        .message-sender {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .message-bubble {
            padding: 10px 14px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 12px 12px 12px 4px;
            font-size: 13px;
            color: var(--text-light);
            line-height: 1.5;
        }

        .chat-message.own .message-bubble {
            background: linear-gradient(135deg, var(--theme-dark), color-mix(in srgb, var(--theme-primary) 60%, var(--dark-surface)));
            border-color: color-mix(in srgb, var(--theme-primary) 30%, transparent);
            border-radius: 12px 12px 4px 12px;
            color: var(--text-white);
        }

        .message-time {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .chat-input-area {
            padding: 16px;
            border-top: 1px solid var(--dark-border);
            position: relative;
            z-index: 1;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: var(--dark-input);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            color: var(--text-white);
            font-family: inherit;
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            transition: all 0.2s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: color-mix(in srgb, var(--theme-primary) 40%, transparent);
            box-shadow: 0 0 0 3px var(--theme-glow);
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--theme-dark), var(--theme-primary));
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px var(--theme-glow);
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--theme-glow);
        }

        .chat-send-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .chat-panel {
                width: 100%;
                max-width: 380px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: fixed;
                left: -100%;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.open {
                left: 0;
            }

            .mobile-toggle {
                display: flex;
            }
        }

        /* Settings Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, #0c0c14 0%, #0a0a10 100%);
            border: 1px solid var(--dark-border);
            border-radius: 20px;
            width: 90%;
            max-width: 440px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6);
            animation: fadeSlideUp 0.3s ease;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            font-size: 18px;
            font-weight: 700;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.04);
            color: var(--text-light);
        }

        .modal-body {
            padding: 24px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .settings-item svg {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
        }

        .settings-item span {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-light);
        }

        .settings-item.danger span {
            color: var(--red);
        }

        .settings-item.danger svg {
            color: var(--red);
        }
    </style>
</head>
<body class="tier-basic">
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-banner">
                    <div class="sidebar-banner-logo">
                        <img src="https://storage.googleapis.com/msgsndr/mCNHhjy593eUueqfuqyU/media/6945a3f159a0a63165eca2d8.svg" alt="Content Bug">
                    </div>
                </div>

                <div class="sidebar-welcome">
                    <p class="welcome-text">Welcome back</p>
                    <h2 class="client-name" id="clientName">Demo Client</h2>
                    <span class="subscription-badge basic" id="subscriptionBadge">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                        </svg>
                        Basic Plan
                    </span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <!-- ADMIN ONLY - Top Level -->
                <div class="nav-section role-admin" data-role="admin,owner">
                    <p class="nav-section-title">Admin</p>

                    <a class="nav-item" data-page="admin-dashboard">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 20V10"/>
                            <path d="M18 20V4"/>
                            <path d="M6 20v-4"/>
                        </svg>
                        Overview
                    </a>

                    <a class="nav-item" data-page="admin-editors">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <line x1="20" y1="8" x2="20" y2="14"/>
                            <line x1="23" y1="11" x2="17" y2="11"/>
                        </svg>
                        Editors
                    </a>

                    <a class="nav-item" data-page="admin-trials">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        Trials & Leads
                    </a>

                    <a class="nav-item" data-page="admin-settings">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        Settings
                    </a>
                </div>

                <!-- TEAM - Editors + Admin -->
                <div class="nav-section role-team" data-role="admin,owner,editor">
                    <p class="nav-section-title">Team</p>

                    <a class="nav-item" data-page="team-pipeline">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="3" x2="9" y2="21"/>
                            <line x1="15" y1="3" x2="15" y2="21"/>
                        </svg>
                        Pipeline
                    </a>

                    <a class="nav-item" data-page="team-schedule">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        Schedule
                    </a>

                    <a class="nav-item" data-page="team-payouts">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        Payouts
                    </a>

                    <a class="nav-item" data-page="team-leaderboard">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                        Leaderboard
                    </a>

                    <a class="nav-item" data-page="team-chat">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        Team Chat
                    </a>
                </div>

                <!-- CLIENT CHANNELS - Editors + Admin (loaded dynamically) -->
                <div class="nav-section role-team" data-role="admin,owner,editor">
                    <p class="nav-section-title client-channels-title" onclick="toggleClientChannels()">
                        <span>Clients</span>
                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </p>
                    <div class="client-channels-list" id="clientChannelsList">
                        <!-- Populated dynamically from MCP server -->
                        <div class="channel-loading">Loading clients...</div>
                    </div>
                </div>

                <!-- CLIENT PORTAL - All Users See This -->
                <div class="nav-section">
                    <p class="nav-section-title">Your Portal</p>

                    <a class="nav-item active" data-page="dashboard">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7" rx="1"/>
                            <rect x="14" y="3" width="7" height="7" rx="1"/>
                            <rect x="3" y="14" width="7" height="7" rx="1"/>
                            <rect x="14" y="14" width="7" height="7" rx="1"/>
                        </svg>
                        Dashboard
                    </a>

                    <a class="nav-item has-notification" data-page="projects">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                        Projects
                        <span class="badge">3</span>
                    </a>

                    <a class="nav-item" data-page="submit">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Submit Project
                    </a>

                    <a class="nav-item" data-page="review">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                        </svg>
                        Review Edits
                    </a>

                    <a class="nav-item" data-page="blueprint">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        Style Blueprint
                    </a>
                </div>

                <!-- Resources -->
                <div class="nav-section">
                    <p class="nav-section-title">Resources</p>

                    <a class="nav-item" data-page="storage">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                        My Files
                    </a>

                    <a class="nav-item locked" data-page="store">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"/>
                            <circle cx="20" cy="21" r="1"/>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                        </svg>
                        Creator Store
                        <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                        <span class="lock-tooltip">Coming Soon</span>
                    </a>
                </div>

                <!-- Help -->
                <div class="nav-section">
                    <p class="nav-section-title">Support</p>

                    <a class="nav-item" data-page="help">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        Help & FAQs
                    </a>
                </div>
            </nav>

            <!-- User Section -->
            <div class="user-section">
                <div class="user-card">
                    <div class="user-avatar" id="userAvatar">
                        DC
                        <span class="status-dot"></span>
                    </div>
                    <div class="user-info">
                        <p class="user-name" id="userName">Demo Client</p>
                        <p class="user-email" id="userEmail">demo@example.com</p>
                    </div>
                    <button class="user-settings-btn" onclick="openSettings()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="main-header">
                <div class="main-header-left">
                    <h2 id="pageTitle">Dashboard</h2>
                    <p id="pageDesc">Your content portal overview</p>
                </div>

                <div class="status-bar">
                    <span class="status-dot-live"></span>
                    <span class="status-text">Connected</span>
                </div>
            </header>

            <div class="main-content" id="mainContent">
                <iframe src="client-dashboard.html" id="contentFrame"></iframe>
            </div>
        </main>

        <!-- Floating Chat Button -->
        <button class="chat-fab" id="chatFab" onclick="toggleChat()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span class="unread-badge" id="chatUnreadBadge">0</span>
        </button>

        <!-- Chat Overlay (for mobile) -->
        <div class="chat-overlay" id="chatOverlay" onclick="toggleChat()"></div>

        <!-- Chat Panel -->
        <aside class="chat-panel" id="chatPanel">
            <header class="chat-header">
                <div class="chat-header-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <h3>Your Team</h3>
                    <span class="online-indicator"></span>
                </div>
                <button class="chat-minimize">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </button>
            </header>

            <div class="chat-messages" id="chatMessages">
                <!-- Welcome message -->
                <div class="chat-message">
                    <div class="message-avatar team">CB</div>
                    <div class="message-content">
                        <p class="message-sender">Content Bug Team</p>
                        <div class="message-bubble">
                            Hey! Welcome to your Content Portal. This is your direct line to our team. Questions about your edits? Drop them here!
                        </div>
                        <p class="message-time">Today at 9:00 AM</p>
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" placeholder="Type a message..." rows="1"></textarea>
                    <button class="chat-send-btn" onclick="sendMessage()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close" onclick="closeSettings()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-item" onclick="navigateTo('account')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span>Account Settings</span>
                </div>
                <div class="settings-item" onclick="navigateTo('billing')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                        <line x1="1" y1="10" x2="23" y2="10"/>
                    </svg>
                    <span>Billing & Plan</span>
                </div>
                <div class="settings-item" onclick="navigateTo('notifications')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                    <span>Notifications</span>
                </div>
                <div class="settings-item danger" onclick="logout()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    <span>Sign Out</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Page navigation configuration
        const pages = {
            // CLIENT PAGES
            dashboard: {
                title: 'Dashboard',
                desc: 'Your content portal overview',
                file: 'client-dashboard.html'
            },
            projects: {
                title: 'Projects',
                desc: 'Track your content pipeline',
                file: 'client-pipeline.html'
            },
            submit: {
                title: 'Submit Project',
                desc: 'Upload new content for editing',
                file: 'client-submit.html'
            },
            review: {
                title: 'Review Edits',
                desc: 'Review and approve your edits',
                file: 'client-review.html'
            },
            blueprint: {
                title: 'Style Blueprint',
                desc: 'Your editing preferences',
                file: 'client-blueprint.html'
            },
            storage: {
                title: 'My Files',
                desc: 'Your content storage',
                file: 'client-storage.html'
            },
            store: {
                title: 'Creator Store',
                desc: 'Templates and resources',
                file: 'client-store.html'
            },
            help: {
                title: 'Help & FAQs',
                desc: 'Get support',
                file: 'client-help.html'
            },

            // ADMIN PAGES
            'admin-dashboard': {
                title: 'Admin Overview',
                desc: 'System-wide metrics and controls',
                file: 'admin-overview.html'
            },
            'admin-editors': {
                title: 'Manage Editors',
                desc: 'Editor assignments and performance',
                file: 'admin-editors.html'
            },
            'admin-trials': {
                title: 'Trials & Leads',
                desc: 'Free trial users and lead tracking',
                file: 'admin-trials.html'
            },
            'admin-settings': {
                title: 'Admin Settings',
                desc: 'System configuration',
                file: 'admin-settings.html'
            },

            // TEAM PAGES
            'team-pipeline': {
                title: 'Team Pipeline',
                desc: 'All active projects across clients',
                file: 'team-pipeline.html'
            },
            'team-schedule': {
                title: 'Schedule',
                desc: 'Editor workload and deadlines',
                file: 'team-schedule.html'
            },
            'team-payouts': {
                title: 'Payouts',
                desc: 'Earnings and payment tracking',
                file: 'team-payouts.html'
            },
            'team-leaderboard': {
                title: 'Leaderboard',
                desc: 'Editor rankings and performance',
                file: 'team-leaderboard.html'
            },
            'team-chat': {
                title: 'Team Chat',
                desc: 'Internal team communication',
                file: 'team-chat.html'
            }
        };

        // Navigation handler
        document.querySelectorAll('.nav-item:not(.locked)').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.dataset.page;
                if (!page || this.classList.contains('locked')) return;

                // Update active state
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                // Load page
                const pageConfig = pages[page];
                if (pageConfig) {
                    document.getElementById('pageTitle').textContent = pageConfig.title;
                    document.getElementById('pageDesc').textContent = pageConfig.desc;
                    document.getElementById('contentFrame').src = pageConfig.file;
                }
            });
        });

        // Load client data from localStorage
        function loadClientData() {
            const name = localStorage.getItem('cb_name') || localStorage.getItem('cb_first_name') || 'Client';
            const email = localStorage.getItem('cb_email') || '';
            const tier = localStorage.getItem('cb_subscription_tier') || 'basic';
            const role = localStorage.getItem('cb_role') || 'client';

            // Update UI
            document.getElementById('clientName').textContent = name;
            document.getElementById('userName').textContent = name;
            document.getElementById('userEmail').textContent = email;

            // Set avatar initials
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            document.getElementById('userAvatar').textContent = initials;

            // Set subscription tier
            setSubscriptionTier(tier);

            // Set role class on body for nav visibility
            setUserRole(role);
        }

        // Set user role for nav visibility
        function setUserRole(role) {
            const validRoles = ['client', 'trial', 'editor', 'admin', 'owner'];
            const normalizedRole = role.toLowerCase();

            // Remove existing role classes
            validRoles.forEach(r => document.body.classList.remove(`is-${r}`));

            // Add new role class
            if (validRoles.includes(normalizedRole)) {
                document.body.classList.add(`is-${normalizedRole}`);
            } else {
                document.body.classList.add('is-client');
            }

            console.log('[Portal] Role set:', normalizedRole);
        }

        // Allow role switching via console for testing
        window.setRole = function(role) {
            localStorage.setItem('cb_role', role);
            setUserRole(role);
        };

        // Set subscription tier styling
        function setSubscriptionTier(tier) {
            const validTiers = ['trial', 'basic', 'silver', 'gold', 'pro'];
            const normalizedTier = tier.toLowerCase();

            // Remove existing tier classes
            validTiers.forEach(t => document.body.classList.remove(`tier-${t}`));

            // Add new tier class
            if (validTiers.includes(normalizedTier)) {
                document.body.classList.add(`tier-${normalizedTier}`);
            } else {
                document.body.classList.add('tier-basic');
            }

            // Update badge
            const badge = document.getElementById('subscriptionBadge');
            badge.className = `subscription-badge ${normalizedTier}`;

            const tierNames = {
                trial: 'Free Trial',
                basic: 'Basic Plan',
                silver: 'Silver Plan',
                gold: 'Gold Plan',
                pro: 'Pro Plan'
            };

            badge.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                </svg>
                ${tierNames[normalizedTier] || tierNames.basic}
            `;
        }

        // Settings modal
        function openSettings() {
            document.getElementById('settingsModal').classList.add('open');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('open');
        }

        // Close modal on overlay click
        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) closeSettings();
        });

        // Chat panel toggle
        let chatOpen = false;

        function toggleChat() {
            chatOpen = !chatOpen;
            const panel = document.getElementById('chatPanel');
            const overlay = document.getElementById('chatOverlay');
            const fab = document.getElementById('chatFab');
            const badge = document.getElementById('chatUnreadBadge');

            if (chatOpen) {
                panel.classList.add('open');
                overlay.classList.add('visible');
                fab.classList.add('hidden');
                badge.classList.remove('visible');
            } else {
                panel.classList.remove('open');
                overlay.classList.remove('visible');
                fab.classList.remove('hidden');
            }
        }

        function closeChat() {
            if (chatOpen) toggleChat();
        }

        // Update minimize button to close chat
        document.querySelector('.chat-minimize')?.addEventListener('click', closeChat);

        // Chat functionality
        const MCP_SERVER = 'https://portalv2.contentbug.io';
        let clientChannelId = null;

        // Ensure chat channel exists on load
        async function ensureClientChannel() {
            const email = localStorage.getItem('cb_email');
            if (!email) return;

            try {
                const response = await fetch(`${MCP_SERVER}/chat/channels/${encodeURIComponent(email)}`, {
                    headers: {
                        'X-User-Email': email,
                        'X-User-Role': 'client'
                    }
                });
                const data = await response.json();

                if (data.channels && data.channels.length > 0) {
                    clientChannelId = data.channels[0].channel_id;
                    loadChatMessages();
                } else {
                    // Create channel
                    const name = localStorage.getItem('cb_name') || 'Client';
                    const createRes = await fetch(`${MCP_SERVER}/chat/channels`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-User-Email': email,
                            'X-User-Role': 'client'
                        },
                        body: JSON.stringify({
                            type: 'client',
                            name: name,
                            client_email: email
                        })
                    });
                    const createData = await createRes.json();
                    if (createData.channel_id) {
                        clientChannelId = createData.channel_id;
                    }
                }
            } catch (err) {
                console.log('[Chat] Channel setup failed:', err.message);
            }
        }

        // Load existing messages
        async function loadChatMessages() {
            if (!clientChannelId) return;

            try {
                const response = await fetch(`${MCP_SERVER}/chat/messages/${clientChannelId}`, {
                    headers: {
                        'X-User-Email': localStorage.getItem('cb_email'),
                        'X-User-Role': 'client'
                    }
                });
                const data = await response.json();

                if (data.messages && data.messages.length > 0) {
                    const messagesContainer = document.getElementById('chatMessages');
                    const userEmail = localStorage.getItem('cb_email');

                    messagesContainer.innerHTML = data.messages.map(msg => {
                        const isOwn = msg.sender_email === userEmail;
                        const initials = (msg.sender_name || 'CB').split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                        const time = new Date(msg.created_at).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

                        return `
                            <div class="chat-message ${isOwn ? 'own' : ''}">
                                <div class="message-avatar">${initials}</div>
                                <div class="message-content">
                                    <div class="message-bubble">${escapeHtml(msg.content)}</div>
                                    <p class="message-time">${time}</p>
                                </div>
                            </div>
                        `;
                    }).join('');

                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            } catch (err) {
                console.log('[Chat] Load messages failed:', err.message);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const messagesContainer = document.getElementById('chatMessages');
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            const userName = document.getElementById('userName').textContent;
            const initials = userName.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            const userEmail = localStorage.getItem('cb_email');

            // Show message immediately
            const messageHTML = `
                <div class="chat-message own">
                    <div class="message-avatar">${initials}</div>
                    <div class="message-content">
                        <div class="message-bubble">${escapeHtml(message)}</div>
                        <p class="message-time">Today at ${timeStr}</p>
                    </div>
                </div>
            `;

            messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            input.value = '';

            // Send to backend
            if (clientChannelId) {
                try {
                    await fetch(`${MCP_SERVER}/chat/send`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-User-Email': userEmail,
                            'X-User-Role': 'client'
                        },
                        body: JSON.stringify({
                            channel_id: clientChannelId,
                            content: message,
                            sender_email: userEmail,
                            sender_name: userName,
                            sender_type: 'client'
                        })
                    });
                } catch (err) {
                    console.log('[Chat] Send failed:', err.message);
                }
            }
        }

        // Poll for new messages every 10 seconds
        setInterval(() => {
            if (clientChannelId && document.getElementById('chatPanel').classList.contains('open')) {
                loadChatMessages();
            }
        }, 10000);

        // Initialize chat channel
        ensureClientChannel();

        // Handle enter key in chat
        document.getElementById('chatInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        document.getElementById('chatInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'https://portalv2.contentbug.io/login';
        }

        function navigateTo(page) {
            closeSettings();
            // Handle navigation to settings sub-pages
            console.log('Navigate to:', page);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadClientData);

        // Demo: Allow tier switching via console
        window.setTier = setSubscriptionTier;

        // ========================================
        // CLIENT CHANNELS (Editors + Admin)
        // ========================================

        // Toggle client channels list collapse/expand
        function toggleClientChannels() {
            const title = document.querySelector('.client-channels-title');
            const list = document.getElementById('clientChannelsList');

            title.classList.toggle('collapsed');
            list.classList.toggle('collapsed');
        }

        // Load client channels from MCP server
        async function loadClientChannels() {
            const role = localStorage.getItem('cb_role') || 'client';
            const email = localStorage.getItem('cb_email');

            // Only editors/admin/owner see this list
            if (!['editor', 'admin', 'owner'].includes(role)) {
                return;
            }

            const listContainer = document.getElementById('clientChannelsList');

            try {
                // Fetch channels from MCP server
                const response = await fetch(`${MCP_SERVER}/inbox`, {
                    headers: {
                        'X-User-Email': email,
                        'X-User-Role': role
                    }
                });

                const data = await response.json();

                if (data.channels && data.channels.length > 0) {
                    listContainer.innerHTML = data.channels
                        .filter(ch => ch.type === 'client') // Only client channels
                        .map(channel => {
                            const initials = (channel.name || 'C').split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                            const tier = channel.tier || 'basic';
                            const unread = channel.unread_count || 0;
                            const status = channel.last_activity ? getRelativeTime(channel.last_activity) : '';

                            return `
                                <div class="channel-item ${unread > 0 ? 'has-unread' : ''}"
                                     onclick="openClientChannel('${channel.channel_id}', '${escapeHtml(channel.name)}')"
                                     data-channel-id="${channel.channel_id}">
                                    <div class="channel-avatar tier-${tier}">${initials}</div>
                                    <div class="channel-info">
                                        <div class="channel-name">${escapeHtml(channel.name)}</div>
                                        ${status ? `<div class="channel-status">${status}</div>` : ''}
                                    </div>
                                    ${unread > 0 ? `<div class="channel-badge">${unread}</div>` : ''}
                                </div>
                            `;
                        }).join('');

                    if (listContainer.innerHTML === '') {
                        listContainer.innerHTML = '<div class="channel-loading">No clients yet</div>';
                    }
                } else {
                    listContainer.innerHTML = '<div class="channel-loading">No clients yet</div>';
                }
            } catch (err) {
                console.log('[Channels] Failed to load:', err.message);
                listContainer.innerHTML = '<div class="channel-loading">Unable to load</div>';
            }
        }

        // Get relative time string
        function getRelativeTime(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        // Open a client channel (switch view)
        function openClientChannel(channelId, clientName) {
            console.log('[Portal] Opening client channel:', channelId, clientName);

            // Update page header
            document.getElementById('pageTitle').textContent = clientName;
            document.getElementById('pageDesc').textContent = 'Client channel';

            // Mark this channel as active
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-channel-id="${channelId}"]`)?.classList.add('active');

            // Remove active from nav items
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));

            // Load client view in iframe (or open chat)
            // For now, we'll switch to this client's chat
            clientChannelId = channelId;
            loadChatMessages();

            // Open chat panel to show this client's conversation
            if (!chatOpen) {
                toggleChat();
            }

            // Update chat header with client name
            document.querySelector('.chat-header-title h3').textContent = clientName;
        }

        // Refresh channels list periodically (every 30s)
        setInterval(() => {
            const role = localStorage.getItem('cb_role') || 'client';
            if (['editor', 'admin', 'owner'].includes(role)) {
                loadClientChannels();
            }
        }, 30000);

        // Load channels on init (for editors/admin)
        loadClientChannels();
    </script>
</body>
</html>
